<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Workday confirmation</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:400,600,700">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/Button-Change-Text-on-Hover.css">
    <link rel="stylesheet" href="assets/css/Chat.css">
    <link rel="stylesheet" href="assets/css/Color-Contact-List.css">
    <link rel="stylesheet" href="assets/css/Contact-Form-v2-Modal--Full-with-Google-Map.css">
    <link rel="stylesheet" href="assets/css/Custom-File-Upload.css">
    <link rel="stylesheet" href="assets/css/Data-Table-styles.css">
    <link rel="stylesheet" href="assets/css/Data-Table.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/css/theme.bootstrap_4.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="assets/css/info-box.css">
    <link rel="stylesheet" href="assets/css/Ludens---1-Dark-mode-Index-Table-with-Search-Filters.css">
    <link rel="stylesheet" href="assets/css/Multi-Select-Dropdown-by-Jigar-Mistry.css">
    <link rel="stylesheet" href="assets/css/Navbar-With-Button-icons.css">
    <link rel="stylesheet" href="assets/css/RULETTE.css">
    <link rel="stylesheet" href="assets/css/Select2-JS-Plugin.css">
</head>

<body>
    <nav class="navbar navbar-light navbar-expand-md fixed-top navbar-shrink py-3" id="mainNav">
        <div class="container"><a class="navbar-brand d-flex align-items-center" href="/"><span>Trucky</span></a><button class="navbar-toggler" data-bs-toggle="collapse"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button></div>
    </nav>
    <section class="py-5 mt-5">
        <div class="container py-5">
            <div class="row mb-5">
                <div class="col-md-8 col-xl-6 text-center mx-auto">
                    <h2 id="confirm_helptext" class="fw-bold"><span class="underline pb-2"></span></h2>
                </div>
            </div>
            <section class="position-relative py-4 py-xl-5">
                <div class="container">
                    <div class="row d-flex justify-content-center">
                        <div class="col-md-6 col-xl-4">
                            <div class="card mb-5">
                                <div class="card-body d-flex flex-column align-items-center"><input type="file" id="user_group_logo" class="custom-file-input" accept="image/*" name="user_group_logo">
                                    <form class="text-center" method="post">
                                        <div class="mb-3">
                                            <form>
                                                <div style="width: 200px;">
                                                    <div class="text-center"><label class="form-label" id="user_group_label" for="user_group_logo"><i class="fas fa-upload"></i>&nbsp;only .png files</label></div>
                                                    <div class="text-center mt-2"></div>
                                                </div>
                                            </form>
                                        </div>
                                    </form>
                                    <form class="text-center" method="post">
                                        <div class="mb-3"><input class="form-control" type="text" name="description" id="description" placeholder="set description if needed"></div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div id="delis" class="col"><small class="form-text">deliveries:</small>

                        </div>
                        <div id="schedules" class="col"><small class="form-text">schedule:</small>
<!--                            <div class="form-check"><input class="form-check-input" type="radio" id="formCheck-6"><label class="form-check-label" for="formCheck-6">normalny harmonogram(9 godzin pracy, 90minut przerwy, 4,5godzin pracy między przerwami)<br></label></div>-->
<!--                            <div class="form-check"><input class="form-check-input" type="radio" id="formCheck-7"><label class="form-check-label" for="formCheck-7">niestandardowy&nbsp;-->
<!--                                <button class="btn btn-primary" type="button">kliknij aby wprowadzić</button></label></div>-->
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary d-block w-100" type="button" onclick="confirmForm()">confirm</button>
            </section>
        </div>
    </section>
    <footer></footer>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="assets/js/Select2-JS-Plugin-1.js"></script>
    <script src="assets/js/Select2-JS-Plugin.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/js/jquery.tablesorter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/js/widgets/widget-filter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.31.2/js/widgets/widget-storage.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/userdetails.js"></script>
</body>


<script>

    var ob2;

    var filedata;

    var workday_id;

    $(document).ready(function() {

        $.get("/workday/confirmdata", function (data) {
            if(data.workday.id==null){
                alert("There's nothing to do today.")
            }
            workday_id = data.workday.id
            ob2 = data.deliveries

            if(data.workday.schedule!=null){
                alert("The workday has already been confirmed, for any changes contact the manager.")
                window.location.href="/profile"
            }
            if(data.deliveries==null){
                alert("No deliveries available, contact with manager.")
            }
            if(data.schedules==null){
                alert("No schedules available, contact with manager.")
            }

            for (let i = 0; i < data.deliveries.length; i++) {
                var delivery = `<div class="form-check"><input class="form-check-input" type="checkbox" id="del` + data.deliveries[i].id + `"><label class="form-check-label" for="formCheck-`+data.deliveries[i].id+`">` + data.deliveries[i].deliveryhash + ", " + data.deliveries[i].description + ", " + data.deliveries[i].deliverycompany+`</label></div>`
                $('#delis').append(delivery)

            }

            for (let i = 0; i < data.schedules.length; i++) {
                var sched = `<div class="form-check"><input class="form-check-input" type="radio" name="scheduleType" value="`+data.schedules[i].id+`" id="schedule`+data.schedules[i].id+`"><label class="form-check-label" for="formCheck-`+data.schedules[i].id+`">`+data.schedules[i].name+", total worktime: "+data.schedules[i].worktime_minutes+", breaks every: "+data.schedules[i].breaks_every_minutes+", total breaks: "+data.schedules[i].break_minutes+`<br></label></div>`
                $('#schedules').append(sched)

            }

            data.date = data.date.replace(/\s00:00:00\.0$/, '');

            $('#confirm_helptext').text("confirm the workday of "+data.date)

        });




    });


    function confirmForm(){
        console.log(123)
        var idArray = [];
        for(let i=0;i<ob2.length;i++){
            if($("#del"+ob2[i].id).is(':checked')){
                idArray.push(ob2[i].id)
            }
        }
        var description = $('#description').val()

        var scheduleId = $('input[name="scheduleType"]:checked').val()

        //filedata and workday_id

        $.post({
            url: "/workday/confirm",
            data: JSON.stringify({
                workdayId: workday_id,
                scheduleId: scheduleId,
                deliveryIds: idArray,
                description: description,
                file: filedata
            }),
            headers: { "Content-Type": "application/json" },
            success: function(data) {
                console.log("Response from server:", data);
                location.reload()
            },
            error: function(error) {
                console.error("Error from server:", error);
            }
        });


    }



    $("input[type='file']").change(function() {
        var file = this.files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
            filedata = e.target.result;

        };
        reader.readAsDataURL(file);
    });
</script>

</html>